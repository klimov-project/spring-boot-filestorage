<!DOCTYPE html>
<html>

    <head>
        <title>Проверка сессий Redis</title>
        <style>
            body {
                font-family: Arial;
                padding: 20px;
            }

            .box {
                border: 2px solid #333;
                padding: 20px;
                margin: 10px;
            }

            .success {
                background: #d4edda;
            }

            .info {
                background: #d1ecf1;
            }
        </style>
    </head>

    <body>
        <h1>Проверка сессий в Redis</h1>

        <div class="box info">
            <h3>Текущая сессия:</h3>
            <p><strong>ID сессии:</strong> {{sessionId}}</p>
            <p><strong>Пользователь:</strong> {{username}}</p>
            <p><strong>Время проверки:</strong> {{sessionTime}}</p>
        </div>

        <div class="box">
            <h3>Войти:</h3>
            <form action="/login-simple" method="POST">
                <input type="text" name="username" placeholder="Введите имя" required>
                <button type="submit">Войти</button>
            </form>
        </div>

        <div class="box">
            <h3>Выйти:</h3>
            <form action="/logout-simple" method="POST">
                <button type="submit">Выйти из сессии</button>
            </form>
        </div>

        <div class="box">
            <h3>Проверка API:</h3>
            <a href="/api/simple/check" target="_blank">Проверить сессию через API</a><br>
            <a href="/api/auth/sign-in" target="_blank">Реальный вход (API)</a><br>
            <a href="/api/user/me" target="_blank">Текущий пользователь (API)</a>
        </div>

        <div class="box">
            <h3>Redis команды для проверки:</h3>
            <pre>
                # Посмотреть все ключи сессий в Redis
                docker exec my_redis redis-cli KEYS "spring:session:*"

                # Посмотреть конкретную сессию (замени YOUR_SESSION_ID)
                docker exec my_redis redis-cli HGETALL "spring:session:sessions:YOUR_SESSION_ID"

                # Посмотреть сессии с истёкшим TTL
                docker exec my_redis redis-cli KEYS "*" | while read line; do echo "$line: $(redis-cli TTL "$line")"; done
        </pre>
        </div>

        <div class="box">
            <h3>Тесты curl для API:</h3>
            <pre>
                # Регистрация
                curl -X POST http://localhost:8080/api/auth/sign-up \
                -H "Content-Type: application/json" \
                -d '{"username":"test","password":"password123"}' \
                -c cookies.txt

                # Вход
                curl -X POST http://localhost:8080/api/auth/sign-in \
                -H "Content-Type: application/json" \
                -d '{"username":"test","password":"password123"}' \
                -c cookies.txt

                # Проверка сессии (с куками)
                curl -X GET http://localhost:8080/api/user/me \
                -b cookies.txt

                # Выход
                curl -X POST http://localhost:8080/api/auth/sign-out \
                -b cookies.txt
        </pre>
        </div>
    </body>

</html>